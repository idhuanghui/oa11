<admintpl file="header"/>
<link href="__ROOT__/statics/simpleboot/css/zTreeStyle.css" rel="stylesheet">
<script type="text/javascript" src="__ROOT__/statics/js/zTree/js/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/zTree/js/jquery.ztree.excheck-3.5.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/My97DatePicker/WdatePicker.js"></script>
<body>
<form class="well form-search" method="post" action="{:U('Sales/index')}">
<div class="Search">
    <div class="tit">
        <h3><i class="icon search_tit"></i>快速搜索</h3>
        <ul class="fr">
            <li><input class="chaxun" type="submit" value="查询"></li>
            <li><a id="exploder" href="javascript:void(0)"><i class="fa fa-reply"></i>导出<input id="explode" name="explode" type="hidden"  value="0" ></a></li>
            <li><a href="javascript:void(0)" class="search_show"><i class="fa fa-chevron-down"></i>收起</a></li>
        </ul>
    </div>
    <div class="s_con fl">
        <ul>
            <if condition="(session('ADMIN_ID') EQ 1) or (session('role_id') EQ 2)">
            <li><em>分部：</em>
                <div class="btn_sel w180">
                <input id="citySel"  type="text" name="departmentname" value="{$formget.departmentname}" class="no_border"  readonly onClick="showMenu();" ><i onClick="showMenu();"></i>  
                </div> 
                <input id="departments" name="departmentid"  type="hidden"  value="{$formget.departmentid}" >
                <div id="menuContent" class="menuContent">
                    <ul id="treeDemo" class="ztree"></ul>
                </div>
            </li>
            <li><em>员工：</em>
                    <input type="text" class="s_btn w100" name="user_realname" value="{$formget.user_realname}" />
                    <input type="hidden" class="s_btn w100" name="user_id" value="{$formget.user_id}" />
            </li>
            </if>
            <li><em>期限：</em>
                <select class="w80" name="time_limit">
                    <option value="">全部</option>
                    <option value="1" <php>echo $formget['time_limit']==1?"selected":""</php> >1个月</option>
                    <option value="2" <php>echo $formget['time_limit']==2?"selected":""</php> >2个月</option>
                    <option value="3" <php>echo $formget['time_limit']==3?"selected":""</php> >3个月</option>
                    <option value="4" <php>echo $formget['time_limit']==4?"selected":""</php> >4个月</option>
                    <option value="6" <php>echo $formget['time_limit']==6?"selected":""</php> >6个月</option>
                    <option value="12" <php>echo $formget['time_limit']==12?"selected":""</php> >12个月</option>
                    <option value="0.5" <php>echo $formget['time_limit']==0.5?"selected":""</php> >0.5个月</option>
                </select>
            </li>
            <li><em>标的类型：</em>
                <select class="w80" name="borrow_type">
                    <option value="" >全部</option>
                    <option value="0" <php>echo $formget['borrow_type']==='0'?"selected":""</php> >汇保贷</option>
                    <option value="1" <php>echo $formget['borrow_type']==1?"selected":""</php> >汇典贷</option>
                    <option value="2" <php>echo $formget['borrow_type']==2?"selected":""</php> >汇小贷</option>
                    <option value="3" <php>echo $formget['borrow_type']==3?"selected":""</php> >汇车贷</option>
                    <option value="5" <php>echo $formget['borrow_type']==5?"selected":""</php> >汇租赁</option>
                    <option value="4" <php>echo $formget['borrow_type']==4?"selected":""</php> >新手标</option>
                </select>
            </li>
            <li><em>客户姓名：</em><input type="text" class="s_btn w100" name="customer" value="{$formget.customer}" /></li>
            <li><em>开始日期：</em><input class="s_btn w100 " type="text" name="begindate"  onclick="WdatePicker()" value="{$formget.begindate}" /></li>
            <li><em>结束日期：</em><input class="s_btn w100 " type="text" name="enddate" onClick="WdatePicker()" value="{$formget.enddate}" /></li>
        </ul>
    </div>
</div>
<div class="Search">
    <div class="tit">
        <h3><i class="icon tab_tit"></i>销售记录</h3>
        <ul class="fr">
            <li>
                <select name="page_size" id="page_size" class="w50 pag_bar">
                    <option value="10" <php>echo $formget['page_size']==10?"selected":""</php> >10</option>
                    <option value="20" <php>echo $formget['page_size']==20?"selected":""</php> >20</option>
                    <option value="50" <php>echo $formget['page_size']==50?"selected":""</php> >50</option>
                    <option value="100" <php>echo $formget['page_size']==100?"selected":""</php> >100</option>
                </select>
            </li>
        </ul>
    </div>
    <div class="con_tab fl">
            <table class="tab_list" width="100%" cellspacing="0" cellpadding="0" border="0">
                <thead>
                <tr>
                    <th class="t_center"width="10%">投资时间</th>
                    <th class="t_center" width="9%">二级分部</th>
                    <th width="10%">所属部门</th>
                    <th width="10%">客户名称</th>
                    <th width="18%">标的名称</th>
                    <th width="10%">投标冻结时间</th>
                    <th class="t_center" width="5%">期限</th>
                    <th class="t_center" width="10%">投标金额</th>
                    <th class="t_center" width="9%">标的类型</th>
                    <th class="t_center" width="9%">员工</th>
                </tr>
                </thead>
                <tbody>
                <foreach name="sales" item="vo">
                    <tr>
                        <td class="t_center">{$vo.success_time|date="Y-m-d H:i:s",###}</td>
                        <td class="t_center" >{$vo.city_department}</td>
                        <td>{$vo.department_name}</td>
                        <td>{$vo.customer}</td>
                        <td>{$vo.borrow_name}</td>
                        <td>{$vo.frozen_time|date="Y-m-d H:i:s",###}</td>
                        <td class="t_center">{:borrowLimit($vo['time_limit'])}</td>
                        <td class="t_center">{$vo.borrow_money}</td>
                        <td class="t_center">{:borrowType($vo['borrow_type'])}</td>
                        <td class="t_center">{$vo.user_realname}</td>
                    </tr>
                </foreach>
                </tbody>
            </table>
    </div>
    <div class="pagination fl">
        {$page}
    </div>
</div>
</form>
<div class="clear h20"> </div>
</body>
<script src="__ROOT__/statics/js/common.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
        //导出
        $('#exploder').click(function(){
            $("#explode").val(1);
            $(".form-search").submit();
            $("#explode").val(0);
        });
        //自动分页
        $('#page_size').change(function(){
            //alert($(this).children('option:selected').val());
            $(".form-search").submit();
        });
    });

    $(".search_show").click(function(){
        $(this).html($(".s_con").is(":hidden") ? "<i class='fa fa-chevron-down'></i>"+"收起" : "<i class='fa fa-chevron-up'></i>"+"展开");
        $(".s_con").slideToggle();
    });
</script>
<SCRIPT type="text/javascript">

    var setting = {
        check: {
            enable: true
        },
        view: {
            dblClickExpand: false
        },
        data: {
            simpleData: {
                enable: true
            }
        },
        callback: {
            beforeClick: beforeClick,
            onCheck: onCheck
        }
    };

    var zNodes = {$select_categorys};

    function beforeClick(treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj("treeDemo");
        zTree.checkNode(treeNode, !treeNode.checked, null, true);
        return false;
    }

    function onCheck(e, treeId, treeNode) {
        var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
                nodes = zTree.getCheckedNodes(true),
                v = "";
        k = "";
        for (var i=0, l=nodes.length; i<l; i++)
        {
            v += nodes[i].name + ",";
        }
        if (v.length > 0 ) v = v.substring(0, v.length-1);
        var cityObj = $("#citySel");
        cityObj.attr("value", v);

        for (var i=0, l=nodes.length; i<l; i++)
        {
            k += nodes[i].id + ",";
        }
        if (k.length > 0 ) k = k.substring(0, k.length-1);
        var cityid = $("#departments");
        cityid.attr("value", k);
    }

    function showMenu() {
        var cityObj = $("#citySel");
        var cityOffset = $("#citySel").offset();
        $("#menuContent").css({left:cityOffset.left + "px", top:cityOffset.top + cityObj.outerHeight() + "px"}).slideDown("fast");

        $("body").bind("mousedown", onBodyDown);
    }
    function hideMenu() {
        $("#menuContent").fadeOut("fast");
        $("body").unbind("mousedown", onBodyDown);
    }
    function onBodyDown(event) {
        if (!(event.target.id == "menuBtn" || event.target.id == "citySel" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {
            hideMenu();
        }
    }


    $(document).ready(function(){
        $.fn.zTree.init($("#treeDemo"), setting, zNodes);
    });
</SCRIPT>
</html>